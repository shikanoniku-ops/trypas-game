# TRYPASゲーム Webアプリケーション 作業指示書

**バージョン:** 1.3  
**作成日:** 2025-11-29  
**最終更新:** 2025-12-11  
**対象:** 開発者・運用担当者 for development and operation tasks.

---

## 目次
1. [開発環境のセットアップ](#1-開発環境のセットアップ)
2. [アプリケーションの起動と停止](#2-アプリケーションの起動と停止)
3. [開発作業手順](#3-開発作業手順)
4. [コード修正手順](#4-コード修正手順)
5. [ビルドとデプロイ](#5-ビルドとデプロイ)
6. [トラブルシューティング](#6-トラブルシューティング)
7. [コードレビューチェックリスト](#7-コードレビューチェックリスト)
8. [バックアップとリストア](#8-バックアップとリストア)
9. [パフォーマンス最適化](#9-パフォーマンス最適化)
10. [セキュリティ対策](#10-セキュリティ対策)

---

## 1. 開発環境のセットアップ

### 1.1 前提条件

#### 必要なソフトウェア
- **Node.js:** v16.0.0 以上
- **npm:** v7.0.0 以上
- **Git:** 最新バージョン
- **コードエディタ:** VS Code推奨

#### 推奨VS Code拡張機能
- ESLint
- Tailwind CSS IntelliSense
- ES7+ React/Redux/React-Native snippets
- Prettier - Code formatter

### 1.2 初回セットアップ手順

```bash
# 1. プロジェクトディレクトリに移動
cd c:\Users\shika\OneDrive\デスクトップ\TRYPASゲーム\trypas-web

# 2. 依存関係のインストール
npm install

# 3. 開発サーバーの起動確認
npm run dev

# 4. ブラウザで確認（通常は http://localhost:5173）
```

### 1.3 環境確認コマンド

```bash
# Node.jsバージョン確認
node --version

# npmバージョン確認
npm --version

# インストール済みパッケージ確認
npm list --depth=0
```

---

## 2. アプリケーションの起動と停止

### 2.1 開発サーバーの起動

```bash
# プロジェクトディレクトリに移動
cd c:\Users\shika\OneDrive\デスクトップ\TRYPASゲーム\trypas-web

# 開発サーバー起動
npm run dev
```

**起動確認:**
- ターミナルに表示されるURL（通常 `http://localhost:5173`）にアクセス
- タイトル画面が表示されることを確認

### 2.2 開発サーバーの停止

```bash
# Ctrl + C を押下
# (Windows PowerShellの場合、確認メッセージが出る場合は Y を入力)
```

### 2.3 ポート変更（必要な場合）

```bash
# ポート番号を指定して起動
npm run dev -- --port 3000
```

---

## 3. 開発作業手順

### 3.1 新機能開発の流れ

#### ステップ1: ブランチ作成（Gitを使用する場合）
```bash
# 現在のブランチを確認
git branch

# 新しいブランチを作成して切り替え
git checkout -b feature/新機能名
```

#### ステップ2: コーディング
1. 該当ファイルを編集
2. 保存（ホットリロードで自動反映）
3. ブラウザで動作確認

#### ステップ3: Lintチェック
```bash
# ESLintでコードチェック
npm run lint
```

#### ステップ4: ビルド確認
```bash
# 本番ビルドが成功するか確認
npm run build
```

#### ステップ5: コミット（Gitを使用する場合）
```bash
# 変更をステージング
git add .

# コミット
git commit -m "機能: 新機能の説明"

# プッシュ
git push origin feature/新機能名
```

### 3.2 ホットリロード（開発時）

開発サーバー起動中は、ファイル保存時に自動的にブラウザがリロードされます。

**対象ファイル:**
- `.jsx` ファイル
- `.js` ファイル
- `.css` ファイル

---

## 4. コード修正手順

### 4.1 コンポーネント修正

#### 例: タイトル画面のボタン文言変更

**対象ファイル:** `src/components/TitleScreen.jsx`

```bash
# 1. ファイルを開く
code src/components/TitleScreen.jsx

# 2. 該当箇所を編集して保存

# 3. ブラウザで確認（自動リロード）
```

### 4.2 ゲームロジック修正

#### 例: コマの得点変更

**対象ファイル:** `src/constants/colors.js`

```javascript
// PIECE_SCORESを編集
export const PIECE_SCORES = {
    RED: 15,      // 10 → 15 に変更
    YELLOW: 25,   // 20 → 25 に変更
    GREEN: 35,    // 30 → 35 に変更
    BLUE: 45,     // 40 → 45 に変更
    WHITE: 55,    // 50 → 55 に変更
};
```

**注意:** 定数ファイル変更後は、依存するコンポーネントも自動で再コンパイルされます。

### 4.3 スタイル修正

#### 例: 背景色の変更

**対象ファイル:** `src/App.jsx`

```jsx
// className内のTailwindクラスを変更
<div className="min-h-screen bg-gray-900 ...">
  ↓
<div className="min-h-screen bg-black ...">
```

### 4.4 CPU難易度の調整

**対象ファイル:** `src/hooks/useGameLogic.js`

CPU対戦ロジックは `useEffect` 内の条件分岐で実装されています。

```javascript
// CPU_HARD の動作を変更する場合
else { // CPU_HARD
    possibleMoves.sort((a, b) => {
        // ここにカスタムロジックを追加
    });
    selectedMove = possibleMoves[0];
}
```

---

## 5. ビルドとデプロイ

### 5.1 本番ビルド

```bash
# 本番用ビルド実行
npm run build
```

**生成物:** `dist/` ディレクトリに最適化されたファイルが生成されます。

```
dist/
├── index.html
├── assets/
│   ├── index-[hash].js
│   └── index-[hash].css
└── vite.svg
```

### 5.2 ビルド確認（ローカルプレビュー）

```bash
# ビルド後のプレビュー
npm run preview
```

通常 `http://localhost:4173` でアクセス可能。

### 5.3 静的ホスティングサービスへのデプロイ

#### Vercelへのデプロイ
```bash
# Vercel CLIのインストール（初回のみ）
npm install -g vercel

# デプロイ実行
vercel

# 本番環境へデプロイ
vercel --prod
```

#### Netlifyへのデプロイ
```bash
# Netlify CLIのインストール（初回のみ）
npm install -g netlify-cli

# デプロイ実行
netlify deploy

# 本番環境へデプロイ
netlify deploy --prod
```

#### GitHub Pagesへのデプロイ

`vite.config.js` に設定を追加:
```javascript
export default defineConfig({
  plugins: [react()],
  base: '/trypas-web/', // リポジトリ名
})
```

```bash
# ビルド
npm run build

# gh-pagesブランチにデプロイ（gh-pagesパッケージ使用）
npm install -D gh-pages
npx gh-pages -d dist
```

---

## 6. トラブルシューティング

### 6.1 開発サーバーが起動しない

#### 問題: `npm run dev` でエラーが出る

**解決策1: 依存関係の再インストール**
```bash
# node_modulesを削除
rm -rf node_modules

# package-lock.jsonを削除
rm package-lock.json

# 再インストール
npm install
```

**解決策2: ポート競合の確認**
```bash
# ポート5173を使用しているプロセスを確認（Windows）
netstat -ano | findstr :5173

# プロセスを終了（タスクマネージャーまたはtaskkill）
taskkill /PID <プロセスID> /F
```

### 6.2 ホットリロードが効かない

#### 問題: ファイル保存してもブラウザが更新されない

**解決策:**
1. ブラウザのキャッシュをクリア（Ctrl + Shift + R）
2. 開発サーバーを再起動
3. VS Codeの設定を確認（auto saveが有効か）

### 6.3 ビルドエラー

#### 問題: `npm run build` が失敗する

**よくあるエラーと対処法:**

**エラー1: メモリ不足**
```bash
# Node.jsのメモリ上限を増やす
set NODE_OPTIONS=--max_old_space_size=4096
npm run build
```

**エラー2: Lintエラー**
```bash
# エラー内容を確認
npm run lint

# 自動修正可能なエラーを修正
npx eslint --fix src/
```

### 6.4 画面が真っ白になる

#### 問題: デプロイ後に画面が表示されない

**チェックポイント:**
1. ブラウザのコンソールでエラーを確認
2. `vite.config.js` の `base` 設定を確認
3. 静的ファイルのパスが正しいか確認

**解決策:**
```javascript
// vite.config.js
export default defineConfig({
  plugins: [react()],
  base: './', // 相対パスに変更
})
```

### 6.5 CPU対戦で動作が止まる

#### 問題: CPU_MODEで無限ループに陥る

**デバッグ方法:**
```bash
# 開発者ツールのコンソールでログ確認
# src/hooks/useGameLogic.js の usEffect内にログ追加

console.log('CPU turn start', { turn, phase, possibleMoves });
```

---

## 7. コードレビューチェックリスト

### 7.1 機能チェック

- [ ] タイトル画面が正しく表示される
- [ ] 各ゲームモードが選択できる
- [ ] ルール説明モーダルが開閉する
- [ ] コマの初期配置がランダムである
- [ ] コマの削除（REMOVING フェーズ）が動作する
- [ ] コマの移動が正しく動作する
- [ ] 有効な移動先がハイライトされる
- [ ] 赤コマボーナスが機能する
- [ ] スコア計算が正しい
- [ ] ゲーム終了判定が正しい
- [ ] 勝者表示が正しい
- [ ] RESETボタンが動作する
- [ ] TITLEボタンが動作する

### 7.2 UI/UXチェック

- [ ] ボタンのホバー効果が動作する
- [ ] アニメーションがスムーズである
- [ ] レスポンシブデザインが機能する
- [ ] タッチデバイスで操作可能である
- [ ] 色のコントラストが十分である

### 7.3 コード品質チェック

- [ ] ESLintエラーがゼロである
- [ ] 未使用のimportがない
- [ ] console.logが残っていない（デバッグ用を除く）
- [ ] コメントが適切に記載されている
- [ ] マジックナンバーが定数化されている

### 7.4 パフォーマンスチェック

- [ ] 初回ロード時間が3秒以内
- [ ] アニメーションが60fps
- [ ] メモリリークがない
- [ ] 不要な再レンダリングがない

---

## 8. バックアップとリストア

### 8.1 プロジェクトのバックアップ

```bash
# Gitリポジトリの場合
git push origin main

# ローカルバックアップ（手動）
# プロジェクトフォルダを別の場所にコピー
```

### 8.2 依存関係のバックアップ

```bash
# package.jsonとpackage-lock.jsonを保存
# これらのファイルから環境を再構築可能
```

### 8.3 リストア手順

```bash
# 1. バックアップからファイルを復元

# 2. 依存関係を再インストール
npm install

# 3. 動作確認
npm run dev
```

---

## 9. パフォーマンス最適化

### 9.1 ビルドサイズの削減

#### 不要なライブラリの除去
```bash
# 使用していない依存関係を確認
npm ls

# 不要なパッケージをアンインストール
npm uninstall <パッケージ名>
```

#### Code Splitting（必要に応じて）
```javascript
// React.lazyを使用した遅延読み込み
import React, { lazy, Suspense } from 'react';

const TitleScreen = lazy(() => import('./components/TitleScreen'));

function App() {
  return (
    <Suspense fallback={<div>Loading...</div>}>
      <TitleScreen />
    </Suspense>
  );
}
```

### 9.2 アニメーション最適化

#### Framer Motionの最適化
```javascript
// layoutIdを使用してパフォーマンス向上
<motion.div layoutId="unique-id" />

// willChangeを使用
<motion.div style={{ willChange: 'transform' }} />
```

### 9.3 画像の最適化

```bash
# WebP形式への変換（必要に応じて）
# 画像圧縮ツールの使用
```

---

## 10. セキュリティ対策

### 10.1 依存関係の脆弱性チェック

```bash
# 脆弱性スキャン
npm audit

# 自動修正（可能な場合）
npm audit fix

# 強制修正（破壊的変更含む）
npm audit fix --force
```

### 10.2 定期的なアップデート

```bash
# 古いパッケージの確認
npm outdated

# パッケージのアップデート
npm update

# メジャーバージョンアップ（慎重に）
npm install <パッケージ名>@latest
```

### 10.3 環境変数の管理（将来的に必要な場合）

`.env` ファイルを使用:
```bash
# .env.example を作成してgitにコミット
VITE_API_URL=https://example.com

# .env はgitignoreに追加
echo ".env" >> .gitignore
```

---

## 11. よくある作業シナリオ

### 11.1 新しいゲームモードの追加

**手順:**
1. `src/hooks/useGameLogic.js` に新モード用ロジックを追加
2. `src/components/TitleScreen.jsx` にボタンを追加
3. `src/App.jsx` でモード判定を追加
4. 動作確認

### 11.2 新しいコマの色の追加

**手順:**
1. `src/constants/colors.js` を編集
   - `PIECE_COLORS` に新色を追加
   - `PIECE_TYPES` に追加
   - `PIECE_SCORES` に得点を追加
2. `src/hooks/useGameLogic.js` の `INITIAL_PIECES_COUNT` を調整（必要に応じて）
3. 動作確認

### 11.3 ボードサイズの変更

**手順:**
1. `src/constants/rules.js` を編集
   - `BOARD_SIZE` を変更
   - `SPOT_COORDINATES` を追加/変更
   - `BOARD_LINES` を再定義
   - `ADJACENCY` を再定義
2. `src/components/GameBoard.jsx` のレイアウトを調整
3. 動作確認

### 11.2 新しいオーディオファイルの追加

**手順:**
1. 音声ファイル（mp3など）を用意する
2. `public/sounds/` ディレクトリに配置する
3. ファイル名にスペースが含まれないようにする（例: `My_Sound.mp3`）
4. コンポーネントまたはフックでパスを指定して読み込む
   ```javascript
   const myBGM = useBackgroundMusic('/sounds/My_Sound.mp3', 0.5);
   ```

### 11.3 ディレクトリ構造クイックリファレンス

```
src/
├── App.jsx              # メインアプリ
├── main.jsx             # エントリーポイント
├── components/          # UIコンポーネント
│   ├── TitleScreen.jsx        # タイトル画面
│   ├── GameBoard.jsx          # ゲームボード
│   ├── ScoreBoard.jsx         # スコア表示
│   ├── Piece.jsx              # コマ
│   └── InitialAudioModal.jsx  # 音声設定
├── hooks/               # カスタムフック
│   ├── useGameLogic.js        # ゲームロジック
│   └── useBackgroundMusic.js  # BGM管理
└── constants/           # 定数
    ├── colors.js        # 色・得点
    └── rules.js         # ルール・ボード定義
```

### 11.4 UI言語の変更（多言語対応）

**将来的な実装案:**
1. `i18next` ライブラリの導入
```bash
npm install i18next react-i18next
```

2. 翻訳ファイルの作成
```javascript
// src/i18n/ja.json
{
  "title": "トライパス",
  "start": "スタート"
}
```

3. コンポーネントで使用
```javascript
import { useTranslation } from 'react-i18next';

const { t } = useTranslation();
return <h1>{t('title')}</h1>;
```

---

## 12. 緊急時対応

### 12.1 本番環境でバグ発見時

**対応手順:**
1. バグの再現手順を記録
2. ローカル環境で再現
3. 修正コードを作成
4. テスト環境で検証
5. 本番環境へデプロイ

**ロールバック:**
```bash
# Gitで前のバージョンに戻す
git log  # コミット履歴確認
git revert <コミットハッシュ>
git push origin main
```

### 12.2 緊急ホットフィックス

```bash
# hotfixブランチ作成
git checkout -b hotfix/緊急修正内容

# 修正＆テスト

# マージ
git checkout main
git merge hotfix/緊急修正内容
git push origin main
```

---

## 13. 連絡先・リソース

### 13.1 参考ドキュメント

- **React公式:** https://react.dev/
- **Vite公式:** https://vitejs.dev/
- **TailwindCSS公式:** https://tailwindcss.com/
- **Framer Motion公式:** https://www.framer.com/motion/

### 13.2 問題報告

**バグ報告時に含める情報:**
- OS / ブラウザ情報
- エラーメッセージ全文
- 再現手順
- スクリーンショット

---

## 14. チートシート

### 14.1 よく使うコマンド

```bash
# 開発サーバー起動
npm run dev

# ビルド
npm run build

# プレビュー
npm run preview

# Lint
npm run lint

# 依存関係インストール
npm install

# 特定パッケージ追加
npm install <パッケージ名>

# 特定パッケージ削除
npm uninstall <パッケージ名>
```

### 14.2 ディレクトリ構造クイックリファレンス

```
src/
├── App.jsx              # メインアプリ
├── main.jsx             # エントリーポイント
├── components/          # UIコンポーネント
│   ├── TitleScreen.jsx  # タイトル画面
│   ├── GameBoard.jsx    # ゲームボード
│   ├── ScoreBoard.jsx   # スコア表示
│   └── Piece.jsx        # コマ
├── hooks/               # カスタムフック
│   └── useGameLogic.js  # ゲームロジック
└── constants/           # 定数
    ├── colors.js        # 色・得点
    └── rules.js         # ルール・ボード定義
```

---

**文書終了**
