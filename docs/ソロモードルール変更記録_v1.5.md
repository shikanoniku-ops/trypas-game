# TRYPASゲーム ソロモードルール変更 実装記録

**実装日:** 2025-12-29  
**バージョン:** 1.5  
**担当者:** アンチグラビティ

---

## 変更概要

ソロモードに以下の2つのルール制限を追加しました：

1. **赤コマ初手禁止**: リムービング（最初の削除）フェーズで赤コマを選択できないようにする
2. **赤コマ終了ペナルティ**: ゲーム終了時、最後の移動で赤コマを取得した場合、スコアが0点になる

---

## 実装内容

### 1. コードの変更

#### 1.1 `src/hooks/useGameLogic.js`

**変更箇所1: リムービングフェーズでの赤コマ禁止**
- 場所: `handleSpotClick` 関数内、REMOVING フェーズの処理
- 実装内容:
  - ソロモード時に赤コマがクリックされた場合、エラーメッセージを表示
  - メッセージ: 「赤コマは最初に取ることはできません」
  - 2秒後に自動でメッセージをクリア

```javascript
// SOLO MODE RULE: Cannot remove red piece at the start
if (isSoloMode && removedColor === 'RED') {
    setLastActionMessage('赤コマは最初に取ることはできません');
    setTimeout(() => setLastActionMessage(''), 2000);
    return;
}
```

**変更箇所2: ゲーム終了時の赤コマペナルティ**
- 場所: `executeMove` 関数内、ゲーム終了判定
- 実装内容:
  - ソロモード時、最後に赤コマを取得した場合、スコアを0点に設定
  - メッセージ: 「最後に赤コマを取ったため、スコアは0点です」

```javascript
if (isSoloMode) {
    // SOLO MODE RULE: Ending with red piece = 0 points
    if (hasRed) {
        setScores({ p1: 0, p2: 0 });
        setLastActionMessage('最後に赤コマを取ったため、スコアは0点です');
    }
    setWinner('SOLO');
}
```

#### 1.2 `src/components/RulesContent.jsx`

- 赤コマボーナスセクションを「赤コマの特殊ルール」に変更
- 3つのサブセクションを追加:
  1. ⚠️ 最初に取ることはできません
  2. ⚠️ 最後に取ると0点
  3. 💡 戦略ポイント

### 2. ドキュメントの更新

#### 2.1 `docs/要件定義書.md`
- バージョン: 1.4 → 1.5
- 最終更新日: 2025-12-11 → 2025-12-29
- US-004（ソロモード）の受入基準に2項目追加:
  - 最初に赤コマを取ることはできない（リムービング時）
  - 最後の移動で赤コマを取得した場合はスコアが0点になる
- 機能要件 5.4 に2項目追加:
  - FR-S-003: 赤コマ初手禁止
  - FR-S-004: 赤コマ終了ペナルティ
- 変更履歴にバージョン1.5を追加

#### 2.2 `docs/システム仕様書.md`
- バージョン: 1.4 → 1.5
- 最終更新日: 2025-12-11 → 2025-12-29
- 変更履歴にバージョン1.5を追加

#### 2.3 `docs/作業指示書.md`
- バージョン: 1.4 → 1.5
- 最終更新日: 2025-12-11 → 2025-12-29

---

## テスト結果

### 機能テスト

✅ **赤コマ初手禁止のテスト**
- REMOVING フェーズで赤コマをクリック → 正しくブロックされる
- エラーメッセージ「赤コマは最初に取ることはできません」が表示される
- 他の色のコマは正常に削除できる

✅ **ルール説明の更新確認**
- ルール説明モーダルに新ルールが正しく表示される
- 赤枠で視覚的に強調されている
- 説明文が分かりやすく記載されている

### 動作確認環境
- ブラウザ: Chrome（開発サーバ）
- URL: http://localhost:5173/
- モード: SOLO PLAY
- 確認日時: 2025-12-29

---

## 影響範囲

### 影響あり
- **ソロモード**: 新ルールが適用される
- **ルール説明**: すべてのモードで新しい説明が表示される

### 影響なし
- **LOCALモード**: 変更なし（従来通り）
- **CPUモード**: 変更なし（従来通り）
- **対戦ルール**: 変更なし（最後に赤を取ると負けルールは以前から存在）

---

## 備考

- デプロイは実施していません（ユーザーの指示通り）
- 開発サーバは引き続き稼働中（`npm run dev`）
- すべてのドキュメントが最新版（v1.5）に更新済み

---

**実装終了**
